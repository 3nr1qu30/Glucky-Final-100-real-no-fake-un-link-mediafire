<%if(typeof curp !== "undefined"){%>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/pacienteDoctor2.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

      <!-- Swiper CSS -->
      <link rel="stylesheet" href="css/swiper-bundle.min.css" />



    <title>Peticiones</title> 
        <!--====== Favicon Icon ======-->
        <link
        rel="shortcut icon"
        href="https://i.ibb.co/2qbH6y4/730-sin-t-tulo-20221221143952.png"
        type="image/svg"
      />
  
</head>
<body>
    <nav>
        <div class="logo-name">
            <div class="logo-image">
                <img src="https://i.ibb.co/8bjZVfw/731-sin-t-tulo-20221215205600.png" alt="">
            </div>

            <span class="logo_name">Glucky</span>
        </div>

        <div class="menu-items">
          <ul class="nav-links">
              <li><a href="/Glucky/Pacientes/Dashboard">
                  <i class="uil uil-estate"></i>
                  <span class="link-name">Casa</span>
              </a></li>
              <li><a href="/Glucky/Pacientes/Solicitudes">
                  <i class="uil uil-user"></i>
                  <span class="link-name">Doctor</span>
              </a></li>
              <li><a href="/Glucky/Pacientes/Chat">
                  <i class="uil uil-chat"></i>
                  <span class="link-name">Chats</span>
              </a></li>
              <li><a href="/Glucky/Pacientes/Asignaciones">
                  <i class="uil uil-plus-circle"></i>
                  <span class="link-name">Asignaciones</span>
              </a></li>
              <li><a href="/Glucky/Pacientes/Historial">
                <i class="uil uil-chart"></i>
                <span class="link-name">Historial de niveles</span>
              </a></li>
          </ul>
          
          <ul class="logout-mode">
              <li><a href="/Glucky/IniciodeSesion">
                  <i class="uil uil-signout"></i>
                  <span class="link-name">Salir</span>
              </a></li>

              <li class="mode">
                  <a href="/Glucky/Pacientes/EditarCuenta">
                      <i class="uil uil-x"></i>
                  <span class="link-name">Ajustes de cuenta</span>
              </a>

              <div class="mode-toggle">
               
              </div>
          </li>
          </ul>
      </div>
    </nav>

    <section class="dashboard">
        <div class="top">
            <i class="uil uil-bars sidebar-toggle"></i>

            <div class="search-box">
                <i class="uil uil-circle"></i>
                <input type="text" placeholder="Aplicación glucky para pacientes" disabled>
            </div>

                <div class="icon" onclick="toggleNotifi()">
			        <div class="noti">17</div>
		        </div>

                <div class="notifi-box" id="box">
                    <h2>Notificaciones: <span>17</span></h2>
                    <div class="notifi-item">
                        <img src="https://uxwing.com/wp-content/themes/uxwing/download/checkmark-cross/cross-icon.png" alt="img">
                        <div class="text">
                           <h4>Elias Abdurrahman</h4>
                           <p>@lorem ipsum dolor sit amet</p>
                        </div> 
                    </div>
        
                   
        
                </div>

            <img src="https://i.pinimg.com/originals/0c/3b/3a/0c3b3adb1a7530892e55ef36d3be6cb8.png" alt="" onclick="toggleNotifi2()">

            <div class="notifi-box2" id="box2">
                <div class="profile-card">
                    <div class="image">
                      <img src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460__340.png" alt="" class="profile-img" />
                    </div>
                    <%if(typeof datpac!=='undefined'){%>
                      <% for(var i=0;i<datpac.length;i++){%>
                        <div class="text-data">
                          <span class="name"><%=datpac[i].nom_pers%> <%=datpac[i].apellidos_pers%></span>
                      <span class="job"><%=datpac[i].curp_pacien%></span>
                      <span class="job"><%=datpac[i].email_pers%></span>
                      <span class="job">Paciente</span>
                      </div>
                    <%}%>
                    <%}%>
                    <div class="media-buttons">
                      <a href="#" style="background: #a1a1a136" class="link">
                        <i class="bx bx-plus-medical"></i>
                      </a>
                    
                    </div>
              
                    <div class="buttons">
                      <button class="button" onclick="toggleNotifi2()"">Cerrar</button>
                      <button class="button"><a href="/Glucky/Pacientes/EditarCuenta" style="color:#ffffff; text-decoration:none;">Cuenta</a></button>
                    </div>
              
                    <div class="analytics">
                      <div class="data">
                        <i class="bx bx-circle"></i>
                        <span class="number">Glucky</span>
                      </div>
                      <div class="data">
                        <i class="bx bx-heart"></i>
                        <span class="number">Paciente</span>
                      </div>
                      <div class="data">
                        <i class="bx bx-award"></i>
                        <span class="number">...</span>
                      </div>
                    </div>
                  </div>
    
            </div>
        
        </div>

        <div class="dash-content">

          
            
          <div class="title">
            <i class="uil uil-abacus" ></i>
            <span class="text">Mis asignaciones</span>
          </div>


          <div class="overlaycard" id="overcardTRATAM" >
            <div class="dispTitulo" id="titucolor">
              <div class="dispTexto"><h3 class="overlay-title">Detalles del tratamiento</h3></div>
              <div class="dispCerrar"><button id="overlay-close" class="overlay-close">×</button></div>
            </div>
            <div class="recuadrodatos">
              <div class="dispo1" id="tituloTratamiento">
              </div>
              <div class="dispo2" id="fechaTratamiento">
              </div>
              <div class="contenido" id="contenidoTratamiento">
              </div>
            </div>
            <div class="formsElEd">
              <br>
            </div>
          </div>
  
  
        <!--Datos a enviar de dieta-->
        <div class="overlaycardDIET verdesC" id="overcardDIET" >
          <div class="dispTitulo" id="titucolor">
            <div class="dispTexto"><h3 class="overlay-title">Detalles de la dieta</h3></div>
            <div class="dispCerrar"><button id="overlay-closeDIet" class="overlay-closeDiet">×</button></div>
          </div>
          
          <div class="recuadrodatos">
            <div class="dispo1" id="tituloDiet" style="margin-left: 2px;">
            </div>
            <div class="dispo2" id="fechaDiet">
            </div>
            <div class="info"> Dieta escrita:</div> 
            <div class="contenido" id="contenidoDiet">
            </div>
          </div>
          <br>
         
        </div>
      <!--Datos a enviar de dieta-->
  
  
          <div class="overlaycardCITA azulesC" id="overcardCITA" >
            <div class="dispTitulo" id="titucolor">
              <div class="dispTexto"><h3 class="overlay-title">Detalles de la cita con <%=nombredoc%></h3></div>
              <div class="dispCerrar"><button id="overlay-closeCITA" class="overlay-closeCita">×</button></div>
            </div>
            
            <div class="recuadrodatos">
              
              <div style="display: none;" id="fechaCITA">

              </div>
             
              <div class="contenido contenido55 nomanchesanakarenelpastel"><b>Dia:</b>
                <div style="display: inline-block;" id="contenidoCITA">
                </div>
              </div>
              <div class="contenido contenido55"><b>Hora:</b>
                <div style="display: inline-block;" id="tituloCITA">
                </div>
              </div>

              <div class="contenido contenido55"><b> Dirección:</b> <%=direccion%></div>
            </div>
            <div class="formsElEd">
              <br>
            </div>
          </div>


      
  
        <div class="container">
          <div class="column1">


            <h3 class="name">Citas totales: <%= citas.length %></h3>


            <%if(citas.length!==0){%>
              <%for(let i =0;i<citas.length;i++){
                var fechita = citas[i].date_cita;%>
              
             
            <div class="card azulesC">
              <input type="hidden" value="<%=citas[i].curp_pacien%>" id="CURP_pacienForm">
              <input type="hidden" value="<%=citas[i].id_cita%>" id="id_citaForm">
             <b class="jajaamiga">Dia y hora de la cita n° <%=i+1%>:</b> 
              <p class="small-content dates"><%=fechita.toISOString().substring(0,10)%></p>
              
              <h4 class="hora"><%=citas[i].hour_cita%></h4>
              <h6><%=citas[i].id_cita%></h6>
            </div>
  
            <%}
          } else{ %>
            En estos momentos, no cuentas con ninguna cita médica programada. Te sugerimos que solicites una cita con tu doctor o esperes a que este te la programe.
            <%}%>
            
          </div>


          <div class="column2">

            <h3 class="name">Tratamientos totales: <%=recetaver.length%></h3>
            <%if(recetaver.length!==0){%>
              <%} else{ %>
                En estos momentos, no cuentas con ninguna receta médica programada.
              <%}%>

            <!--UN TRATAMIENTO-->
            <% if (recetaverTodas.length !== 0) {
              const recetasPorId = {};
              recetaverTodas.forEach((receta) => {
                if (!recetasPorId[receta.id_receta]) {
                  recetasPorId[receta.id_receta] = [receta];
                } else {
                  recetasPorId[receta.id_receta].push(receta);
                }
              });
              const gruposDeRecetas = Object.values(recetasPorId);
              gruposDeRecetas.forEach((grupoDeRecetas, index) => {
              const fechaDePublicacionReceta = grupoDeRecetas[0].date_receta.toISOString().substring(0, 10);
            %>

          <div class="card amarillosC">
            <h4 class="nomani">Tratamiento <%= index + 1 %></h4>

            <% grupoDeRecetas.forEach((receta) => { %>
              <div class="small-content granadagrande"><%= receta.nom_medic %>, cantidad: <%= receta.frec_recmed %> %></div>
            <% }); %>

            
            <% let listaMedicamentos = ""; %>
                <% grupoDeRecetas.forEach((receta) => { %>
                  <% listaMedicamentos += `<li> <b> ${receta.nom_medic} </b> cantidad: ${receta.frec_recmed} tipo: ${receta.present_recmed}</li> `; %>
                <% }); %>
                <p class="small-content arianagrenade"><%= listaMedicamentos.slice(0, -2) %></p>

                <br>
                <h6 class="fechass"> fecha de publicación: <%= fechaDePublicacionReceta %></h6>
              </div>
            <% });
          }%>
            <!--FIN TRATAMIENTO-->


          </div>


          <div class="column3">

            <!--UNA DIETA-->  
            <h3  class="name">Dietas totales: <%=dietas.length%> </h3>

            <%if(dietas.length!==0){%>
            <%} else{ %>
              No tienes dietas con tu paciente, agrega dietas usando el botón de acciones
            <%}%>
  
            <% if (dietasverTodas.length !== 0) {
              const dietasPorId = {};
              dietasverTodas.forEach((dieta) => {
                if (!dietasPorId[dieta.id_dieta]) {
                  dietasPorId[dieta.id_dieta] = [dieta];
                } else {
                  dietasPorId[dieta.id_dieta].push(dieta);
                }
              });
              const gruposDeDietas = Object.values(dietasPorId);
              gruposDeDietas.forEach((grupoDeDietas, index) => {
              const fechaDePublicacion = grupoDeDietas[0].date_dieta.toISOString().substring(0, 10);
            %>
           
                <div class="card verdesC">
                  <h4 class="nomani">Dieta <%= index + 1 %></h4>
                  
                  <% grupoDeDietas.forEach((dieta) => { %>
                    <div class="small-content granadagrande"><%= dieta.nom_ingred %>: <%= dieta.desc_ingred %></div>
                    
                  <% }); %>
  
                  
                  <% let listaIngredientes = ""; %>
                  <% grupoDeDietas.forEach((dieta) => { %>
                    <% listaIngredientes += `<li> <b> ${dieta.nom_ingred}: </b> ${dieta.desc_ingred}</li> `; %>
                  <% }); %>
                  <p class="small-content arianagrenade"><%= listaIngredientes.slice(0, -2) %></p>
  
  
                  <br>
                  <h6 class="fechass"> fecha de publicación: <%= fechaDePublicacion %></h6>
                </div>
              <% });
            }%>
          </div>
            <!--FIN DIETA--> 


          </div>



        </div>
    
    

          

    
    <script src="/js/asignacionesCitasPacientes.js">


    </script>




  
    
</body>
</html>
<%}else{%>
  <!DOCTYPE html>
<html>
  <head>
    <title>Error - Debes Iniciar Sesión</title>
  </head>
  <body>
    <script src="/js/plantillaAlertas.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
      SesionCad()
    </script>
  </body>
</html>
<%}%>